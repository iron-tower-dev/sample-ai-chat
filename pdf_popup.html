<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NOVA Chat Application</title>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #eef1f5;
    overflow: hidden;
  }

  /* TOP HEADER */
  #top-header {
    height: 55px;
    width: 100vw;
    background: #1b3455;
    color: white;
    display: flex;
    align-items: center;
    padding: 0 20px;
    font-size: 18px;
    font-weight: bold;
    box-sizing: border-box;
    position: relative;
    z-index: 10;
  }

  /* LEFT SIDEBAR – CONVERSATION LIST */
  #left-sidebar {
    position: absolute;
    top: 55px;
    left: 0;
    width: 260px;
    height: calc(100vh - 55px);
    background: #ffffff;
    border-right: 1px solid #ccc;
    overflow-y: auto;
    padding: 10px;
    box-sizing: border-box;
    z-index: 5;
  }

  #pdf-frame {
  width: 100%;
  height: 100%;
  border: none;
  }

  #new-chat-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 10px;
    padding: 10px;
    background: #1b3455;
    color: white;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }

  #new-chat-btn:hover {
    background: #2c4a7b;
  }

  .conv-item {
    padding: 12px;
    margin-bottom: 8px;
    background: #f4f4f4;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.2s;
  }
  .conv-item:hover {
    background: #e2ecff;
  }

  /* CHAT CONTAINER */
  #chat-wrapper {
    position: absolute;
    top: 55px;
    left: 260px;
    width: calc(100vw - 260px);
    height: calc(100vh - 55px - 70px);
    display: flex;
    justify-content: center;
    transition: width 0.3s ease, left 0.3s ease;
  }

  #chat-container {
    width: 50%; /* centered narrow column */
    max-width: 600px;
    height: 100%;
    padding: 20px;
    overflow-y: auto;
    box-sizing: border-box;
    transition: width 0.3s ease;
  }

  .chat-msg {
    margin-bottom: 12px;
    padding: 12px 16px;
    border-radius: 8px;
    background: #ffffff;
    box-shadow: 0 2px 5px rgba(0,0,0,0.08);
  }

  .chat-msg.user {
    background: #e2f0ff;
    align-self: flex-end;
  }

  .source-link {
    cursor: pointer;
    text-decoration: underline;
    color: #007bff;
  }

  /* CHAT INPUT BAR */
  #chat-input-bar {
    position: absolute;
    bottom: 0;
    height: 70px;
    background: #ffffff;
    display: flex;
    align-items: center;
    padding: 10px 15px;
    box-sizing: border-box;
    border-top: 1px solid #d0d0d0;
    transition: width 0.3s ease, left 0.3s ease;
  }

  #msg-input {
    flex-grow: 1;
    padding: 10px 12px;
    border-radius: 6px;
    border: 1px solid #ccc;
    outline: none;
    font-size: 15px;
  }

  #send-btn {
    margin-left: 10px;
    padding: 10px 16px;
    background: #1b3455;
    border: none;
    border-radius: 6px;
    color: white;
    cursor: pointer;
  }

  /* PDF PANEL */
  #pdf-panel {
    position: absolute;
    top: 55px;
    right: -50vw; /* hidden off-screen */
    width: 50vw;
    height: calc(100vh - 55px);
    background: #fff;
    display: flex;
    flex-direction: row;
    box-shadow: -4px 0 12px rgba(0,0,0,0.25);
    transition: right 0.3s ease;
    z-index: 20;
  }

  #pdf-viewer {
  flex: 2;
  padding: 0;          /* remove extra padding */
  background: #f0f2f5;
  box-sizing: border-box;
  height: 100%;
  width: 100%;
  overflow: hidden;    /* disable extra scroll */
  }

  #pdf-canvas {
    width: 100%;
    background: white;
    box-shadow: 0 3px 15px rgba(0,0,0,0.12);
    border-radius: 4px;
  }

  #sidebar {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    background: #ffffff;
    border-left: 1px solid #ddd;
  }

  .chunk-btn {
    padding: 10px;
    margin-bottom: 8px;
    background: #f5f5f5;
    border: 1px solid #ccc;
    border-radius: 6px;
    cursor: pointer;
  }
  .chunk-btn:hover {
    background: #eaf1ff;
  }

  #close-pdf {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #1b3455;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
  }
</style>
</head>
<body>

<!-- TOP HEADER -->
<div id="top-header">
  NOVA — Nuclear Operations Virtual Assistant
</div>

<!-- LEFT SIDEBAR -->
<div id="left-sidebar">
  <div id="new-chat-btn">+ New Chat</div>
  <div class="conv-item">Conversation 1</div>
  <div class="conv-item">Conversation 2</div>
  <div class="conv-item">Conversation 3</div>
</div>

<!-- CHAT WRAPPER -->
<div id="chat-wrapper">
  <div id="chat-container">
    <!-- Chat messages -->
    <div class="chat-msg user">
      Hi NOVA, can you summarize the latest nuclear report?
    </div>
    <div class="chat-msg">
      Sure! The report highlights that reactor X has increased efficiency by 3% this month.
      Click the source for details:
      <span class="source-link" onclick="openPdf('http://10.7.203.34:30080/get_document?filepath=PROCEDURES%2FPROC%2F36%2F36ST&filename=%7BDE897F88-04C5-C1E7-BE1B-8B8264900004%7D_%7B765CDBF1-F2D4-C643-9D3B-8B8264900000%7D_11104445.pdf')">[Source: 36ST-9SE01]</span>
    </div>
    <div class="chat-msg user">
      Thanks! What about the safety protocols?
    </div>
    <div class="chat-msg">
      The safety protocols are all up to date. There were no violations reported in the past quarter.
    </div>
    <div class="chat-msg user">
      Great, and any notes on maintenance schedules?
    </div>
    <div class="chat-msg">
      Maintenance for reactor X is scheduled for next week. All equipment inspections are complete.
    </div>
  </div>
</div>

<!-- CHAT INPUT BAR -->
<div id="chat-input-bar">
  <input id="msg-input" placeholder="Type your message..."/>
  <button id="send-btn">Send</button>
</div>

<!-- PDF PANEL -->
<div id="pdf-panel">
  <button id="close-pdf" onclick="closePdf()">Close</button>

  <div id="pdf-viewer">
    <iframe id="pdf-frame" style="width:100%; height:100%; border:none;"></iframe>
  </div>

  <div id="sidebar">
    <h3>Document Chunks</h3>
    <div id="chunks"></div>

    <h3>Document Information</h3>
    <div class="metadata" id="metadata"></div>
  </div>
</div>



<script>
const chunkData = [
  { id: "Section 1", page: 2, score: "90%"},
  { id: "Section 2", page: 5, score: "75%"},
  { id: "Section 3", page: 7, score: "60%"}
];

const docMetadata = {
  title: "36ST-9SE01",
  revision: "111",
  SWMSTitle: "EXCORE SAFETY CHANNEL LOG CALIBRATION",
  SWMSStatus: "ARCHIVED",
  Category: "PROCEDURES",
  DocType: "PROC",
  sourceUrl: "test.com"
};

async function openPdf(url) {
  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error("Failed to fetch PDF");

    const blob = await response.blob();
    const blobUrl = URL.createObjectURL(blob);

    const frame = document.getElementById("pdf-frame");
    frame.src = blobUrl;

    document.getElementById("pdf-panel").style.right = "0";

    const chatWrapper = document.getElementById("chat-wrapper");
    chatWrapper.style.width = "50%";
    chatWrapper.style.justifyContent = "flex-start";

    const inputBar = document.getElementById("chat-input-bar");
    inputBar.style.width = "50%";
    inputBar.style.left = "260px";

    populateSidebar();
  } catch (err) {
    console.error("Error opening PDF:", err);
  }
}

function closePdf() {
  document.getElementById("pdf-panel").style.right = "-50vw";

  const chatWrapper = document.getElementById("chat-wrapper");
  chatWrapper.style.width = "calc(100vw - 260px)";
  chatWrapper.style.justifyContent = "center";

  const inputBar = document.getElementById("chat-input-bar");
  inputBar.style.width = "calc(100vw - 260px)";
  inputBar.style.left = "260px";
}

/* SIDEBAR POPULATION */
function populateSidebar() {
  const chunksDiv = document.getElementById("chunks");
  chunksDiv.innerHTML = "";

  chunkData.forEach(chunk => {
    const btn = document.createElement("div");
    btn.className = "chunk-btn";
    btn.textContent = `${chunk.id} — ${chunk.score}`;
    btn.onclick = () => {
      alert("Jumping to a specific page is not supported in iframe mode.");
    };
    chunksDiv.appendChild(btn);
  });

    const metadataDiv = document.getElementById("metadata");
    metadataDiv.innerHTML = `
      <div style="font-size: 20px; font-weight: bold; margin-bottom: 10px;">${docMetadata.title}</div>
      <div><strong>Revision:</strong> ${docMetadata.revision}</div>
      <div><strong>SWMS Title:</strong> ${docMetadata.SWMSTitle}</div>
      <div><strong>SWMS Status:</strong> ${docMetadata.SWMSStatus}</div>
      <div><strong>Category:</strong> ${docMetadata.Category}</div>
      <div><strong>Document Type:</strong> ${docMetadata.DocType}</div>
    `;

    // Set button link
    const sourceBtn = document.getElementById("go-to-source");
    sourceBtn.onclick = () => {
      window.open(docMetadata.sourceUrl, "_blank");
    };
}

/* NEW CHAT BUTTON */
document.getElementById("new-chat-btn").onclick = () => {
  const chatContainer = document.getElementById("chat-container");
  chatContainer.innerHTML = "";
};
</script>